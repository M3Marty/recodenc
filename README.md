EU4 официально локализована на английский, немецкий, французский, испанский. Для поддержки этих языков достаточно кодировки CP1252 (висьмибитная кодировка), поддержка юникода в движке игры отсутствует. Соответственно, поддержка кириллицы отсутствует. Для нужд русского перевода игры потребовался механизм отображения кириллицы. Т. к. движок игры поддерживает восьмибитную кодировку, заменив поставляемые для поддержки CP1252 шрифты на шрифты для CP1251, можно отобразить кириллицу, закодированную в CP1251. Эти две кодировки совместимы по кодовым позициям ASCII в начале каждой из кодовых страниц (0-127), что позволяет отображать [английский текст], но текст, содержащий символы из второй половины кодировки (128-255) CP1252, отображается как кириллица. Эта проблема малозначительна для Full-версии перевода, но для Lite-версии, где смешан текст в латинице и кириллице, она встаёт в полный рост. Для решения проблемы одновременного отображения расширенной литиницы (вторая половина CP1252) и кириллицы я разработал специальную кодировку «CP1252+CYR», совместимую с CP1252 по расположению латиницы, а специальные типографские символы (напр., ¥) заменил на буквы кириллицы, отсутствующие в литинице.

Движок игры сопоставляет кодовую позицию символа с его рисунком в шрифте и выводит его. Существует несколько программ для рендеринга шрифтов, совместимых с движком игры, я использовал BMFont[привести ссылку]. Сгенерированный шрифт располагается в двух файлах: изображении tga или dds и текстовом файле fnt, содержащим карту изображения и связывающим кодовую позицию символа с его представлением в графическом виде. Сгенерировать растровые шрифты для кодировки CP1251 относительно легко: достаточно указать программе эту кодировку и исходный векторный шрифт. Для создания шрифта для кодировки CP1252+CYR необходимо выбрать кодировку юникод и в ней выбрать символы из CP1252+CYR, отрендерить шрифт, и в fnt-файле в столбце «id» и секции кернингов заменить номера кодовых позиций юникода на номера из CP1252+CYR.

Официальная локализация поставляется в виде файлов YAML в кодировке UTF-8 с BOM, обрыв строки в формате *nix. Но движок игры использует CP1252, поэтому на этапе загрузки локализации происходит перекодировка: символы с позиций в кодировке юникод становятся на позиции в кодировке CP1252. Следовательно, чтобы запросить отображение кириллического символа, его код после перекодировки должен соответствовать номеру в шрифте. Поэтому кириллицу, закодированную в UTF8 на этапе редактирования перевода, нужно заменить на символы, которые после перекодирования движком игры отображаются как кириллица. В этом нам поможет программа Recodenc.

Для того, чтобы воспользоваться скриптом, установите Perl и модуль Tk.

При запуске скрипт отображает окно. В рамке «EU4» можно выбрать кодировку (CP1251 или CP1252+CYR); каталог с локализацией, требующей перекодировки; если установлен флажок «Сохранить в», то исходные файлы не будут изменены, а перекодированные файлы будут сохранены в отдельном каталоге, выбранном справа от флага; нажатие на кнопку запусает обработку. После нажатия на кнопку следует подождать, пока интерфейс скрипта отвиснет. Я не делал никаких индикаторов намеренно, так как они будут выводится медленнее, чем будет происходить обработка. При закрытии окна скрипт сохраняет параметры в файле с именем файла скрипта и расширением «conf» в каталоге, где расположен. Для ручного редактирования этот файл не предназмачен. Но его можно удалять — тогда он будет создан заново. Формат перекодированных файлов: UTF-8 с BOM, обрывы строк — LF. Т. е. как у разработчиков. Не открывайте и не редактируйте перекодированные файлы во избежание повреждения данных.

В рамке «EU4 шрифты ...» расположено средство модификации fnt-файлов, заменяющее номера символов в кодировке юникод на соответствующие номера в CP1252+CYR. Изображения шрифтов при этом переименованы/скопированы не будут — используйте для этого файловый менеджер.

Символы кодировки CP1251 (отображаемые EU4):

     !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~
    Ђ‚ѓ„…†‡€‰Љ‹ЊЋЏ‘’“”•–—™љ›њћџ ЎўЈ¤Ґ¦§Ё©Є«¬®Ї°±Ііґµ¶·ё№є»јЅѕїАБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюя

Символы кодировки CP1252 (отображаемые EU4):

     !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~
    €‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ ¡¢¥¦¨©ª«¬®¯°±²³´µ¶·¸¹º»¼¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ

Символы кодировки CP1252+CYR (отображаемые EU4):

     !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~
    БГДЖЗИЙЛПŠУŒŽФЦЧШЩЪЫЬЭšЮœžŸб¡вгджзийклмнптуфцчшщъыьэю¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖЯØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõöяøùúûüýþÿ

